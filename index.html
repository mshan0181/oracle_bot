<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle RAG Chatbot</title>
    <style>
        /* Base styles with a background image */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-image: url("{{ url_for('static', filename='oracle_logo.png') }}");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: #333;
        }

        /* Main container for the chat and upload sections */
        .main-container {
            max-width: 1200px;
            margin: 50px auto;
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.85);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            height: 900px;
            display: flex;
            flex-direction: column;
        }

        /* Titles */
        h1, h2 {
            text-align: center;
            color: #005A9C;
        }

        /* Chatbot section */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding-bottom: 20px; /* Space for the input area */
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: #fafafa;
        }
        .message-box {
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .user-message { text-align: right; background-color: #e6f7ff; }
        .bot-message { text-align: left; background-color: #f0f0f0; }

        /* Input and send button for chat */
        #chat-form {
            display: flex;
            gap: 5px;
        }
        #chat-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #send-button {
            padding: 8px 12px;
            border: none;
            background-color: #005A9C;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        /* PDF upload section */
        .upload-container {
            margin-top: 20px;
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #ccc;
        }
        #uploadForm {
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }
        #uploadMessage {
            margin-top: 10px;
            font-weight: bold;
        }
        #uploadButton {
            padding: 8px 12px;
            border: none;
            background-color: #005A9C;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="chat-container">
            <h1>Oracle RAG Chatbot ðŸ¤–</h1>
            <div id="chat-messages">
                <div class="message-box bot-message">Hello! I am an AI assistant. How can I help you with your Oracle database documentation?</div>
            </div>
            <form id="chat-form">
                <input type="text" id="chat-input" placeholder="Type your question...">
                <button type="submit" id="send-button">Send</button>
            </form>
        </div>

        <div class="upload-container">
            <h2>Upload New Documentation ðŸ“š</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="pdfFile" name="pdf_file" accept=".pdf" required>
                <button type="submit" id="uploadButton">Upload PDF</button>
            </form>
            <div id="uploadMessage"></div>
        </div>
    </div>

    <script>
        // Chatbot functionality
        document.getElementById('chat-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const input = document.getElementById('chat-input');
            const chatMessages = document.getElementById('chat-messages');
            const query = input.value.trim();

            if (query === '') return;

            // Display user message
            const userMessageDiv = document.createElement('div');
            userMessageDiv.classList.add('message-box', 'user-message');
            userMessageDiv.textContent = `You: ${query}`;
            chatMessages.appendChild(userMessageDiv);
            
            // Clear input field
            input.value = '';

            // Display "thinking" message
            const botMessageDiv = document.createElement('div');
            botMessageDiv.classList.add('message-box', 'bot-message');
            botMessageDiv.textContent = 'Chatbot: Thinking...';
            chatMessages.appendChild(botMessageDiv);
            
            // Scroll to the bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Send query to the backend
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                
                // Update the bot's response
                botMessageDiv.textContent = `Chatbot: ${data.response}`;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            } catch (error) {
                console.error('Error:', error);
                botMessageDiv.textContent = 'Chatbot: An error occurred. Please try again.';
            }
        });

        // PDF Upload functionality
        document.getElementById('uploadForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const uploadMessageDiv = document.getElementById('uploadMessage');
            const uploadButton = document.getElementById('uploadButton');

            // Disable button and show a loading message
            uploadButton.disabled = true;
            uploadMessageDiv.innerText = "Uploading and processing... Please wait.";
            uploadMessageDiv.style.color = "gray";

            try {
                const response = await fetch('/upload_pdf', {
                    method: 'POST',
                    body: formData,
                });
                const data = await response.json();

                uploadMessageDiv.innerText = data.message || data.error;
                if (data.error) {
                    uploadMessageDiv.style.color = "red";
                } else {
                    uploadMessageDiv.style.color = "green";
                    // Clear the file input after successful upload
                    document.getElementById('pdfFile').value = '';
                }
            } catch (error) {
                console.error('Error:', error);
                uploadMessageDiv.innerText = "An error occurred during upload.";
                uploadMessageDiv.style.color = "red";
            } finally {
                // Re-enable the button
                uploadButton.disabled = false;
            }
        });
    </script>
</body>
</html>